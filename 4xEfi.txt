// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © ozcanozbek

//@version=5
indicator("4xEfi")

//EFI
var cumVol = 0.
cumVol += nz(volume)
if barstate.islast and cumVol == 0
    runtime.error("Hacim Verisine Erişilemiyor!")
length = input.int(5, minval=1, title = "EFI Uzunluğu", group="EFI Ayarları")
acCizgiEFI = input(defval = false, title = 'EFI Çizgisi Gösterilsin mi?', group="EFI Ayarlar")  
efi = ta.ema(ta.change(close) * volume, length)

myColorY = efi>=0 and efi>efi[1] ? color.lime : color.white
myColorD = efi<0 and efi<=efi[1] ? color.red : color.yellow

myColor =  efi>=0 ? myColorY : myColorD



//DMI 
lensig = input.int(14, title="ADX Smoothing", minval=1, maxval=50, group="DMI Ayarlar")
len = input.int(14, minval=1, title="DI Length", group="DMI Ayarlar")
up = ta.change(high)
down = -ta.change(low)
plusDM = na(up) ? na : (up > down and up > 0 ? up : 0)
minusDM = na(down) ? na : (down > up and down > 0 ? down : 0)
trur = ta.rma(ta.tr, len)
plus = fixnan(100 * ta.rma(plusDM, len) / trur)
minus = fixnan(100 * ta.rma(minusDM, len) / trur)
sum = plus + minus
adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), lensig)


boyaAdx = efi>0 ? color.new(color.white,0) : color.new(#ff0000,0)
//pAdx = plot(adx, color=boyaAdx, title="ADX",linewidth=2, style =plot.style_circles)
//pPlus = plot(plus, color=color.new(color.lime,0), title="+DI", linewidth=2)
//pMinus = plot(minus, color=color.new(color.red,0), title="-DI",linewidth=2)


myBoya = plus >= minus ? color.new(color.lime,60) : color.new(color.red,66) 
//fill(pPlus, pMinus , title = 'DI+ Bölge', color = myBoya, fillgaps = true)
bgcolor(plus >= minus ?  color.new(color.lime,77) : color.new(color.red,100))
plot(adx and acCizgiEFI? adx : na, color=myColor, title="Elders Force Index",linewidth=3)
